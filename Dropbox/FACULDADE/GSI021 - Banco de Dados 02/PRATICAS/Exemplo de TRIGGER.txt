-- Verifica a comissao e insere em uma trabela de auditoria salario

ALTER SESSION SET nls_timestamp_format = 'dd/mm/yyyy hh24:mi:ss.ff';

--

CREATE OR REPLACE TRIGGER preenche_auditoria_salarios
BEFORE INSERT OR UPDATE OF salfixo ON VENDEDOR
FOR EACH ROW
WHEN (new.faixacomis = 'A')
BEGIN
    INSERT INTO auditoria_salarios
    (codvend,old_salfixo,new_salfixo,data_alt,operacao,nomeuser,ts_data)
    VALUES(:new.codvend,:old.salfixo,:new.salfixo,sysdate,'update','Bruno',localtimestamp);
END preenche_auditoria_salarios;
